# 摩托车成本分析模型 - 字段定义与逻辑关系文档

## 文档概述

本文档详细列出了摩托车成本分析模型项目中所有涉及的数据字段、配置参数、计算逻辑及其相互关系。

---

## 1. 配置常量字段

**文件位置：** `config.js`

### 1.1 应用配置常量

| 字段名 | 类型 | 默认值 | 说明 |
|-------|------|--------|------|
| `DEFAULT_SCHEME_KEY` | String | `'120.8'` | 默认激活的计算方案 |
| `DEFAULT_ANALYSIS_TAB` | String | `'combined'` | 默认显示标签页（综合/车险/摩托） |
| `THEME_STORAGE_KEY` | String | `'costInsightProTheme'` | 本地存储主题配置的键名 |

### 1.2 指标配置（14个核心指标）

**位置：** `APP_CONFIG.INDICATOR_CONFIG` (config.js, 第8-23行)

| 指标键 | 中文名称 | 颜色策略 | 是否比率 | 特殊属性 | 业务含义 |
|-------|---------|---------|---------|---------|---------|
| `PREMIUM` | 保费 | neutral | ✗ | - | 保险收入基数 |
| `LOSS` | 赔款 | neutral | ✗ | - | 理赔支出金额 |
| `HANDLING_FEE` | 手续费 | neutral | ✗ | - | 业务处理费用 |
| `SALES_PROMOTION` | 销推费用 | neutral | ✗ | - | 营销推广成本 |
| `LABOR_COST` | 人力成本 | neutral | ✗ | - | 人员工资及福利 |
| `EDGE_CONTRIBUTION` | 边际贡献额 | conditional | ✗ | positiveGood: true | 扣除变动成本后的贡献 |
| `PROFIT` | 利润 | conditional | ✗ | positiveGood: true | 净利润金额 |
| `TCR` | 综合成本率 | conditional | ✓ | threshold: 1, higherIsWorse: true | 总成本占保费比例 |
| `VCR` | 变动成本率 | conditional | ✓ | threshold: 0.9, higherIsWorse: true | 变动成本占保费比例 |
| `LOSS_RATIO` | 赔付率 | neutral | ✓ | - | 赔款占保费比例 |
| `HANDLING_FEE_RATIO` | 手续费率 | neutral | ✓ | - | 手续费占保费比例 |
| `SALES_PROMOTION_RATIO` | 销推费用率 | neutral | ✓ | - | 销推费占保费比例 |
| `LABOR_COST_RATIO` | 人力成本率 | neutral | ✓ | - | 人力成本占保费比例 |
| `EDGE_CONTRIBUTION_RATIO` | 边际贡献率 | conditional | ✓ | positiveGood: true | 边际贡献占保费比例 |

**颜色策略说明：**
- `neutral`：中性灰色显示
- `conditional`：根据数值好坏动态调整颜色（绿色=良好，红色=需改进）

### 1.3 指标分组

**绝对值指标组（用于金额图表）：**
```
['PREMIUM', 'LOSS', 'HANDLING_FEE', 'SALES_PROMOTION', 'LABOR_COST', 'EDGE_CONTRIBUTION', 'PROFIT']
```

**比率指标组（用于比率图表）：**
```
['TCR', 'VCR', 'LOSS_RATIO', 'HANDLING_FEE_RATIO', 'SALES_PROMOTION_RATIO', 'LABOR_COST_RATIO', 'EDGE_CONTRIBUTION_RATIO']
```

### 1.4 预设方案配置

**位置：** `APP_CONFIG.SCHEMES` (config.js, 第26-31行)

| 方案键 | 方案名称 | 车险赔付率 | 摩托赔付率 | 说明 |
|-------|---------|-----------|-----------|------|
| `'150'` | 方案A | 150% | 4% | 高赔付场景 |
| `'135'` | 方案B | 135% | 4% | 中高赔付场景 |
| `'120.8'` | 方案C（保本） | 120.8% | 4% | **盈亏平衡点** |
| `'110'` | 方案D | 110% | 4% | 低赔付/盈利场景 |

---

## 2. 输入参数字段（12个）

**文件位置：** `index.html` (表单输入区域，第108-110行) 和 `config.js` (INPUT_SELECTORS)

### 2.1 基础参数（2个）

| 字段名 | DOM ID | 类型 | 默认值 | 单位 | 步进 | 说明 |
|-------|--------|------|--------|------|------|------|
| `laborBaseRate` | #laborBaseRate | number | 2.8 | % | 0.1 | 人力成本基准系数 |
| `fixedOperationRate` | #fixedOperationRate | number | 7.21 (config) / 6 (HTML) | % | 0.1 | 固定运营成本率 |

### 2.2 车险参数（5个）

| 字段名 | DOM ID | 类型 | 默认值 | 单位 | 步进 | 说明 |
|-------|--------|------|--------|------|------|------|
| `carPremium` | #carPremium | number | 1200 (config) / 1000 (HTML) | 万元 | 100 | 车险保费基数 |
| `carLossRatio` | #carLossRatio | number | 120.8-150% | % | 0.1 | 车险赔付率 |
| `carHandlingFeeRate` | #carHandlingFeeRate | number | 0 | % | 0.1 | 车险手续费率 |
| `carSalesPromotionRate` | #carSalesPromotionRate | number | 0.15 (config) / 0.3 (HTML) | % | 0.1 | 车险销推费率 |
| `carStandardPremiumRatio` | #carStandardPremiumRatio | number | 0.5 | 倍数 | 0.1 | 车险标准保费系数 |

### 2.3 摩托车险参数（5个）

| 字段名 | DOM ID | 类型 | 默认值 | 单位 | 步进 | 说明 |
|-------|--------|------|--------|------|------|------|
| `motoPremiumRatio` | #motoPremiumRatio | number | 1.75 | 倍数 | 0.01 | 摩托保费相对车险的倍数 |
| `motoLossRatio` | #motoLossRatio | number | 4 (config) / 2.4 (HTML) | % | 0.1 | 摩托险赔付率 |
| `motoHandlingFeeRate` | #motoHandlingFeeRate | number | 66.1 | % | 0.1 | 摩托险手续费率（获客成本） |
| `motoSalesPromotionRate` | #motoSalesPromotionRate | number | 0.74 (config) / 0.9 (HTML) | % | 0.1 | 摩托险销推费率 |
| `motoStandardPremiumRatio` | #motoStandardPremiumRatio | number | 1.8 | 倍数 | 0.1 | 摩托险标准保费系数 |

---

## 3. 计算输出字段（84个）

**文件位置：** `main.js` - `performCalculations()` 函数 (第127-133行)

### 数据结构
```javascript
{
  car: {
    absolute: [7个绝对值],
    rate: [7个比率值]
  },
  moto: {
    absolute: [7个绝对值],
    rate: [7个比率值]
  },
  combined: {
    absolute: [7个绝对值],
    rate: [7个比率值]
  }
}
```

### 3.1 车险 - 绝对值（7个）

| 索引 | 字段名 | 计算公式 | 单位 |
|-----|--------|---------|------|
| 0 | 车险保费 | 输入值 `carPremium` | 万元 |
| 1 | 车险赔款 | `carPremium × carLossRatio` | 万元 |
| 2 | 车险手续费 | `carPremium × carHandlingFeeRate` | 万元 |
| 3 | 车险销推费 | `carPremium × carSalesPromotionRate` | 万元 |
| 4 | 车险人力成本 | `carPremium × carStandardPremiumRatio × laborBaseRate` | 万元 |
| 5 | 车险边际贡献 | `carPremium × (1 - carVariableCostRate)` | 万元 |
| 6 | 车险利润 | `carPremium × (1 - carTotalCostRate)` | 万元 |

### 3.2 车险 - 比率（7个）

| 索引 | 字段名 | 计算公式 | 范围 |
|-----|--------|---------|------|
| 0 | 车险综合成本率 | `carVariableCostRate + fixedOperationRate` | 0-1 |
| 1 | 车险变动成本率 | `carLossRatio + carHandlingFeeRate + carSalesPromotionRate + carLaborCostRate` | 0-1 |
| 2 | 车险赔付率 | 输入值 `carLossRatio` | 0-1 |
| 3 | 车险手续费率 | 输入值 `carHandlingFeeRate` | 0-1 |
| 4 | 车险销推费率 | 输入值 `carSalesPromotionRate` | 0-1 |
| 5 | 车险人力成本率 | `carStandardPremiumRatio × laborBaseRate` | 0-1 |
| 6 | 车险边际贡献率 | `1 - carVariableCostRate` | 0-1 |

### 3.3 摩托险 - 绝对值（7个）

| 索引 | 字段名 | 计算公式 | 单位 |
|-----|--------|---------|------|
| 0 | 摩托保费 | `carPremium × motoPremiumRatio` | 万元 |
| 1 | 摩托赔款 | `motoPremium × motoLossRatio` | 万元 |
| 2 | 摩托手续费 | `motoPremium × motoHandlingFeeRate` | 万元 |
| 3 | 摩托销推费 | `motoPremium × motoSalesPromotionRate` | 万元 |
| 4 | 摩托人力成本 | `motoPremium × motoStandardPremiumRatio × laborBaseRate` | 万元 |
| 5 | 摩托边际贡献 | `motoPremium × (1 - motoVariableCostRate)` | 万元 |
| 6 | 摩托利润 | `motoPremium × (1 - motoTotalCostRate)` | 万元 |

### 3.4 摩托险 - 比率（7个）

| 索引 | 字段名 | 计算公式 | 范围 |
|-----|--------|---------|------|
| 0 | 摩托综合成本率 | `motoVariableCostRate + fixedOperationRate` | 0-1 |
| 1 | 摩托变动成本率 | `motoLossRatio + motoHandlingFeeRate + motoSalesPromotionRate + motoLaborCostRate` | 0-1 |
| 2 | 摩托赔付率 | 输入值 `motoLossRatio` | 0-1 |
| 3 | 摩托手续费率 | 输入值 `motoHandlingFeeRate` | 0-1 |
| 4 | 摩托销推费率 | 输入值 `motoSalesPromotionRate` | 0-1 |
| 5 | 摩托人力成本率 | `motoStandardPremiumRatio × laborBaseRate` | 0-1 |
| 6 | 摩托边际贡献率 | `1 - motoVariableCostRate` | 0-1 |

### 3.5 综合（车+摩托）- 绝对值（7个）

| 索引 | 字段名 | 计算公式 | 单位 |
|-----|--------|---------|------|
| 0 | 总保费 | `carPremium + motoPremium` | 万元 |
| 1 | 总赔款 | `carLoss + motoLoss` | 万元 |
| 2 | 总手续费 | `carHandlingFee + motoHandlingFee` | 万元 |
| 3 | 总销推费 | `carSalesPromotion + motoSalesPromotion` | 万元 |
| 4 | 总人力成本 | `carLaborCost + motoLaborCost` | 万元 |
| 5 | 总边际贡献 | `carEdgeContribution + motoEdgeContribution` | 万元 |
| 6 | 总利润 | `carProfit + motoProfit` | 万元 |

### 3.6 综合 - 比率（7个）

| 索引 | 字段名 | 计算公式 | 范围 |
|-----|--------|---------|------|
| 0 | 综合成本率 | `totalVariableCostRate + fixedOperationRate` | 0-1 |
| 1 | 综合变动成本率 | `totalVariableCost / totalPremium` | 0-1 |
| 2 | 综合赔付率 | `totalLoss / totalPremium` | 0-1 |
| 3 | 综合手续费率 | `totalHandlingFee / totalPremium` | 0-1 |
| 4 | 综合销推费率 | `totalSalesPromotion / totalPremium` | 0-1 |
| 5 | 综合人力成本率 | `totalLaborCost / totalPremium` | 0-1 |
| 6 | 综合边际贡献率 | `1 - totalVariableCostRate` | 0-1 |

---

## 4. KPI 显示字段（4个）

**文件位置：** `main.js` - `updateKPIs()` 函数 (第104-117行)

| KPI字段 | DOM ID | 数据来源 | 格式化方式 | 说明 |
|--------|--------|---------|-----------|------|
| 总利润 | #kpiTotalProfit | combined.absolute[6] | 保留1位小数 + "万元" | 车险+摩托险总利润 |
| 综合成本率 | #kpiTotalCostRate | combined.rate[0] | 百分比 × 100 + "%" | 总成本占总保费比例 |
| 总保费 | #kpiTotalPremium | combined.absolute[0] | 保留1位小数 + "万元" | 车险+摩托险总保费 |
| 总边际贡献 | #kpiTotalEdgeContribution | combined.absolute[5] | 保留1位小数 + "万元" | 扣除变动成本后的贡献 |

---

## 5. 洞察摘要字段

**文件位置：** `main.js` - `updateContextInsight()` 函数 (第70-87行)

| 字段名 | 类型 | 计算来源 | 说明 |
|-------|------|---------|------|
| `isHealthy` | boolean | `profit >= 0 && tcr <= 1` | 业务健康状态判断 |
| `headline` | string | 动态生成 | 主标题："盈利区间健康" 或 "需要重点优化亏损" |
| `insight` | string | 动态生成 | 详细业务建议内容 |
| `subline` | string | 模板字符串 | 支持数据摘要（包含关键指标） |

**洞察逻辑：**
```javascript
if (profit >= 0 && tcr <= 1) {
  状态 = "健康"
  建议 = "保持当前策略..."
} else {
  状态 = "需优化"
  建议 = "重点关注成本控制..."
}
```

---

## 6. 图表配置元数据（6个图表）

**文件位置：** `main.js` (CHART_META, 第263-270行)

| 图表键 | 图表类型 | 数据来源 | 标题 | 生成函数 |
|-------|---------|---------|------|---------|
| `carAbsolute` | bar | car.absolute | 关键指标金额（万元） | createAbsoluteChartOption |
| `carRate` | bar | car.rate | 核心效能比率（%） | createRateChartOption |
| `motoAbsolute` | bar | moto.absolute | 关键指标金额（万元） | createAbsoluteChartOption |
| `motoRate` | bar | moto.rate | 核心效能比率（%） | createRateChartOption |
| `combinedAbsolute` | bar | combined.absolute | 关键指标金额（万元） | createAbsoluteChartOption |
| `combinedRate` | bar | combined.rate | 核心效能比率（%） | createRateChartOption |

**标签页到图表映射（TAB_CHARTS）：**
- `combined` → ['combinedAbsolute', 'combinedRate']
- `car` → ['carAbsolute', 'carRate']
- `moto` → ['motoAbsolute', 'motoRate']

---

## 7. 应用状态字段

**文件位置：** `main.js` (第3-7行)

| 字段名 | 类型 | 说明 |
|-------|------|------|
| `DOMElements` | object | 缓存的DOM元素引用（性能优化） |
| `EChartsInstances` | object | 活动的ECharts实例（6个图表） |
| `currentInputValues` | object | 当前输入值快照（用于变更检测） |
| `exportCounter` | number | 导出CSV文件的计数器 |
| `lastCalculatedData` | object | 最近一次计算结果缓存 |

---

## 8. 主题配置字段

**文件位置：** CSS变量 和 localStorage

### 8.1 主题颜色（CSS变量）

| CSS变量 | 深色模式 | 浅色模式 | 用途 |
|---------|---------|---------|------|
| `--color-positive` | #32d74b | #228435 | 正向指标颜色（利润、贡献等） |
| `--color-negative` | #ff453a | #d70015 | 负向指标颜色（亏损、高成本等） |
| `--color-neutral` | #8e8e93 | #6e6e73 | 中性指标颜色 |
| `--color-accent` | hsl(210, 100%, 50%) | hsl(210, 100%, 50%) | 主色调 |

### 8.2 图表调色板

**深色模式：**
```
['--color-accent', '#5e5ce6', '#64d2ff', '#ff9f0a', '#bf5af2', '#30d15b', '#ff453a']
```

**浅色模式：**
```
['--color-accent', '#5856d6', '#5ac8fa', '#ff9500', '#af52de', '#34c759', '#dc3545']
```

---

## 9. 数据导出字段

**文件位置：** `main.js` - `exportDataToCSV()` 函数 (第305-323行)

### CSV导出内容
- 车险指标（绝对值 + 比率）
- 摩托险指标（绝对值 + 比率）
- 综合指标（绝对值 + 比率）
- **文件命名格式：** `摩托车成本分析_YYYYMMDD_###.csv`
- **导出时间戳：** 包含在文件名中

---

## 10. 核心逻辑关系

### 10.1 数据流向图

```
┌──────────────────────────┐
│  输入参数（12个字段）      │
│  - 基础参数（2个）         │
│  - 车险参数（5个）         │
│  - 摩托险参数（5个）       │
└────────────┬─────────────┘
             │
             ↓
┌──────────────────────────┐
│  计算引擎                 │
│  performCalculations()   │
└────────────┬─────────────┘
             │
      ┌──────┴──────┐
      ↓             ↓
┌──────────┐  ┌──────────┐
│车险计算   │  │摩托险计算 │
│(14个字段) │  │(14个字段) │
└─────┬────┘  └────┬─────┘
      │            │
      └──────┬─────┘
             ↓
    ┌────────────────┐
    │  综合计算       │
    │  (14个字段)    │
    └────────┬───────┘
             │
       ┌─────┴─────┬─────────┬─────────┐
       ↓           ↓         ↓         ↓
   ┌──────┐   ┌───────┐  ┌──────┐  ┌──────┐
   │ KPI  │   │ 洞察  │  │ 图表 │  │ CSV  │
   │ 更新 │   │ 摘要  │  │ 渲染 │  │ 导出 │
   └──────┘   └───────┘  └──────┘  └──────┘
```

### 10.2 关键计算公式

#### A. 成本率计算
```
变动成本率 = 赔付率 + 手续费率 + 销推费率 + 人力成本率
人力成本率 = 标准保费系数 × 人力基准系数
综合成本率 = 变动成本率 + 固定运营成本率
```

#### B. 盈利能力指标
```
边际贡献 = 保费 × (1 - 变动成本率)
利润 = 保费 × (1 - 综合成本率)
边际贡献率 = 1 - 变动成本率
```

#### C. 综合指标（车+摩托）
```
总保费 = 车险保费 + (车险保费 × 摩托保费倍数)
总变动成本 = 总赔款 + 总手续费 + 总销推费 + 总人力成本
综合变动成本率 = 总变动成本 / 总保费
综合成本率 = 综合变动成本率 + 固定运营成本率
```

### 10.3 依赖关系矩阵

| 依赖字段 | 被依赖的基础字段 |
|---------|----------------|
| **车险人力成本** | carPremium, carStandardPremiumRatio, laborBaseRate |
| **车险变动成本率** | carLossRatio, carHandlingFeeRate, carSalesPromotionRate, carLaborCostRate |
| **车险综合成本率** | carVariableCostRate, fixedOperationRate |
| **车险利润** | carPremium, carTotalCostRate |
| **摩托保费** | carPremium, motoPremiumRatio |
| **摩托人力成本** | motoPremium, motoStandardPremiumRatio, laborBaseRate |
| **综合指标** | 对应的车险+摩托险字段 |
| **KPI显示** | combined.absolute[], combined.rate[] |
| **洞察摘要** | totalProfit, totalCostRate |

### 10.4 业务规则

1. **盈亏平衡点：** 综合成本率 = 100%（1.0）
2. **健康状态判断：** 利润 ≥ 0 且 综合成本率 ≤ 100%
3. **变动成本临界值：** 变动成本率建议 ≤ 90%（0.9）
4. **颜色指示规则：**
   - 利润/边际贡献：正值=绿色，负值=红色
   - 成本率：≤阈值=绿色，>阈值=红色

---

## 11. 字段统计汇总

| 类别 | 数量 |
|------|------|
| **输入参数** | 12个（2基础 + 5车险 + 5摩托） |
| **计算输出字段** | 84个（3类 × 14指标 × 2维度） |
| **KPI显示字段** | 4个 |
| **配置指标** | 14个（7绝对值 + 7比率） |
| **预设方案** | 4个（A/B/C/D方案） |
| **图表** | 6个（3标签页 × 2图表类型） |
| **主题模式** | 2个（深色/浅色） |
| **分析标签页** | 4个（综合/车险/摩托/帮助） |

---

## 12. 关键业务逻辑

### 12.1 方案切换逻辑
```javascript
用户选择方案 → 加载预设参数 → 触发计算 → 更新所有视图
```

### 12.2 实时计算触发
```javascript
输入值变更 → debounce(300ms) → performCalculations() → 更新KPI/图表/洞察
```

### 12.3 数据验证
- 所有比率字段：0.1步进，支持小数点后1位
- 保费字段：100步进，整数
- 倍数字段：0.01/0.1步进

### 12.4 图表自适应
```javascript
标签页切换 → 显示对应图表 → resize图表适应容器 → 应用主题配置
```

---

## 附录：文件位置索引

| 功能模块 | 文件 | 关键行数 |
|---------|------|---------|
| 配置定义 | config.js | 全文（1-61行） |
| 输入表单 | index.html | 108-110行（输入区） |
| 计算引擎 | main.js | 127-133行 |
| KPI更新 | main.js | 104-117行 |
| 洞察生成 | main.js | 70-87行 |
| 图表配置 | main.js | 136-270行 |
| 数据导出 | main.js | 305-323行 |
| 主题切换 | index.html | 245-269行（CSS变量） |

---

**文档版本：** 1.0
**生成日期：** 2025-12-06
**项目分支：** claude/document-project-fields-012gN9eFxHGURB8xyk72dT58
